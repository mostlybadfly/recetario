{% extends 'recipes/base.html' %}
{% load static %}

{% block content %}
<div class="col-md-4">
  <form action="" method="post">{% csrf_token %}
    {{ form.as_p }}

    <table class="table">
        {{ ingredients.management_form }}

        {% for form in ingredients.forms %}
          {% if forloop.first %}
            <thead>
            <tr>
                {% for field in form.visible_fields %}
                    <th>{{ field.label|capfirst }}</th>
                {% endfor %}
            </tr>
            </thead>
          {% endif %}
          <tr class="ingredient_formset_row">
            {% for field in form.visible_fields %}
              <td>
                {% if forloop.first %}
                  {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                  {% endfor %}
                {% endif %}
                {{ field.errors.as_ul }}
                {{ field }}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
    </table>
    <table class="table">
        {{ instructions.management_form }}

        {% for form in instructions.forms %}
          {% if forloop.first %}
            <thead>
            <tr>
                {% for field in form.visible_fields %}
                    <th>{{ field.label|capfirst }}</th>
                {% endfor %}
            </tr>
            </thead>
          {% endif %}
          <tr class="instruction_formset_row">
            {% for field in form.visible_fields %}
              <td>
                {% if forloop.first %}
                  {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                  {% endfor %}
                {% endif %}
                {{ field.errors.as_ul }}
                {{ field }}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
    </table>
    <input type="submit" value="Save"/> <a href="{% url 'index' %}">back to the list</a>
  </form>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="{% static 'formset/jquery.formset.js' %}"></script>
<script type="text/javascript">
  $('.ingredient_formset_row').formset({
      addText: 'add ingredient',
      deleteText: 'remove',
      prefix: '{{ ingredients.prefix }}',
      formCssClass: 'ingredients-formset'
  });
  $('.instruction_formset_row').formset({
      addText: 'add a step',
      deleteText: 'remove',
      prefix: '{{ instructions.prefix }}',
      formCssClass: 'instructions_formset'
  });
</script>
{% endblock %}
